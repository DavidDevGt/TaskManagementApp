<ion-header [translucent]="true">
  <ion-toolbar color="secondary">
    <ion-title>Nueva Tarea</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="resetForm()" color="light">
        <ion-icon slot="icon-only" name="refresh-outline" aria-label="Reiniciar formulario"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Crear Tarea</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-card class="ion-margin">
    <ion-card-header>
      <ion-card-subtitle>Completa los detalles de la nueva actividad.</ion-card-subtitle>
    </ion-card-header>
    
    <ion-card-content>
      <form [formGroup]="taskForm" (ngSubmit)="onSubmit()">

        <ion-list lines="none">
          
          <ion-item class="ion-margin-vertical">
            <ion-icon slot="start" name="document-text-outline" color="secondary"></ion-icon>
            <ion-input 
              formControlName="title" 
              label="Título" 
              labelPlacement="floating" 
              placeholder="Escribe un título descriptivo"
              required>
            </ion-input>
            <ion-note slot="helper" color="danger" *ngIf="taskForm.get('title')?.invalid && taskForm.get('title')?.touched">
              El título es obligatorio.
            </ion-note>
          </ion-item>

          <ion-item class="ion-margin-vertical">
            <ion-icon slot="start" name="bookmark-outline" color="secondary"></ion-icon>
            <ion-select 
              formControlName="typeId" 
              label="Tipo" 
              labelPlacement="floating" 
              interface="popover" 
              placeholder="Selecciona la categoría"
              required>
              <ion-select-option *ngFor="let type of taskTypes; trackBy: trackByType" [value]="type.id">{{ type.name }}</ion-select-option>
            </ion-select>
            <ion-note slot="helper" color="danger" *ngIf="taskForm.get('typeId')?.invalid && taskForm.get('typeId')?.touched">
              Debes seleccionar un tipo.
            </ion-note>
          </ion-item>

          <ion-item class="ion-margin-vertical">
            <ion-icon slot="start" name="chatbox-outline" color="secondary"></ion-icon>
            <ion-textarea 
              formControlName="description" 
              label="Descripción" 
              labelPlacement="floating" 
              placeholder="Detalles adicionales (opcional)" 
              [autoGrow]="true"
              rows="3">
            </ion-textarea>
          </ion-item>
        </ion-list>
        
        <ion-button 
          expand="block" 
          type="submit" 
          [disabled]="!taskForm.valid" 
          class="ion-margin-top" 
          color="success">
          <ion-icon slot="start" name="add-circle-outline"></ion-icon>
          Crear Tarea
        </ion-button>

      </form>
    </ion-card-content>
  </ion-card>

  <ion-toast
    [isOpen]="showToast"
    [message]="toastMessage"
    duration="2000"
    (didDismiss)="showToast = false">
  </ion-toast>
</ion-content>